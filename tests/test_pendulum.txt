Turn this into a .c file and create tests here